name: Kaizen Code Review (Internal)

on:
  pull_request:
    types: [closed]
  workflow_dispatch:
    inputs:
      pr_number:
        required: true
        description: "Pull Request number to review"
        type: number

jobs:
  kaizen-review:
    name: Kaizen Code Review
    # Only run on merged PRs to non-main branches (not just closed, and not to main)
    if: |
      (github.event.pull_request.merged == true && github.event.pull_request.base.ref != 'main')
      || github.event_name == 'workflow_dispatch'
    permissions:
      contents: read
      pull-requests: write
      issues: read
      id-token: write
    uses: innago-property-management/Oui-DELIVER/.github/workflows/kaizen-code-review.yml@v2
    with:
      pr_number: ${{ github.event.pull_request.number || inputs.pr_number }}
      repository: ${{ github.repository }}
    secrets:
      anthropicKey: ${{ secrets.ANTHROPIC_API_KEY }}
      githubToken: ${{ secrets.GITHUB_TOKEN }}
