on:
  push:
    branches-ignore:
      - main
  workflow_dispatch:

jobs:
  create-array:
    runs-on: ubuntu-latest
    outputs:
      file_list: ${{ steps.list_files.outputs.output_files }}
    steps:
      - name: List Files and Create Array
        id: list_files
        run: |
          # Example: Create an array of files in the current directory
          FILES=($(ls -1 *.yml))
          
          # Encode the array as JSON to pass as a single string output
          JSON_OUTPUT=$(jq --compact-output --argjson files "${FILES[@]}" '{"files": $files}')
          
          # Set the output using the GITHUB_OUTPUT environment file
          echo "output_files=$JSON_OUTPUT" >> "$GITHUB_OUTPUT"
  
  use-array:
    runs-on: ubuntu-latest
    needs: create-array
    steps:
      - name: Use Array Output
        run: |
          # Parse the JSON output back into a usable array
          FILES_JSON="${{ needs.create-array.outputs.file_list }}"
          FILES=$(echo "$FILES_JSON" | jq -r '.files[]')
          
          # Print the files (iterate if necessary)
          echo "Files found:"
          echo "$FILES"
          
          # You can process the array elements here
          # for file in ${FILES[@]}; do
          #   echo "- $file"
          # done