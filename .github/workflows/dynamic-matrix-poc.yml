on:
  push:
    branches-ignore:
      - main
  workflow_dispatch:

jobs:
  create-array:
    runs-on: ubuntu-latest
    outputs:
      file_list: ${{ steps.list_files.outputs.output_files }}
    steps:
      - name: Checkout code
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4
      - name: List Files and Create Array
        id: list_files
        run: |
          FILES=$(ls -1 | tr '\n' ' ')
          echo "${FILES}"
          echo "output_files=${FILES}" >> "$GITHUB_OUTPUT"
  
  use-array:
    runs-on: ubuntu-latest
    needs: create-array
    steps:
      - name: Use Array Output
        run: |
          # Parse the JSON output back into a usable array
          FILES_JSON="${{ needs.create-array.outputs.file_list }}"
          FILES=$(echo "$FILES_JSON" | jq -r '.files[]')
          
          # Print the files (iterate if necessary)
          echo "Files found:"
          echo "$FILES"
          
          # You can process the array elements here
          # for file in ${FILES[@]}; do
          #   echo "- $file"
          # done